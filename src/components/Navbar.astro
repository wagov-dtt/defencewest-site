---
const base = import.meta.env.BASE_URL;
const isHomepage = Astro.url.pathname === base || Astro.url.pathname === base.slice(0, -1);
const isContact = Astro.url.pathname.includes('/contact');
---

<header class="site-header">
  <div class="header-container">
    <a href="https://www.wa.gov.au/organisation/department-of-the-premier-and-cabinet/defence-west" class="logo-wrapper">
      <img src={`${base}defence-west-logo.svg`} alt="Defence West logo" />
    </a>
    <div role="group" class="view-toggle">
      {isHomepage ? (
        <>
          <a href={base} role="button" id="view-directory" class="contrast">Directory</a>
          <a href={`${base}?view=map`} role="button" id="view-map" class="contrast outline">Map</a>
          <a href={`${base}contact`} role="button" class="contrast outline">Contact</a>
        </>
      ) : (
        <>
          <a href={base} role="button" class="contrast outline">Directory</a>
          <a href={`${base}?view=map`} role="button" class="contrast outline">Map</a>
          <a href={`${base}contact`} role="button" class={`contrast ${isContact ? '' : 'outline'}`}>Contact</a>
        </>
      )}
    </div>
    <a href="https://www.wa.gov.au/organisation/department-of-energy-and-economic-diversification" class="gov-logo">
      <img src={`${base}wa-gov-logo.png`} alt="Government of Western Australia logo" />
    </a>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const dirBtn = document.getElementById('view-directory');
    const mapBtn = document.getElementById('view-map');
    
    if (dirBtn && mapBtn) {
      // Check URL param on load and set correct active state
      const isMapView = new URLSearchParams(window.location.search).get('view') === 'map';
      if (isMapView) {
        dirBtn.classList.add('outline');
        mapBtn.classList.remove('outline');
      }
      
      dirBtn.addEventListener('click', (e) => {
        e.preventDefault();
        window.showCards?.();
        dirBtn.classList.remove('outline');
        mapBtn.classList.add('outline');
        history.pushState({}, '', dirBtn.href.split('?')[0]);
      });
      
      mapBtn.addEventListener('click', (e) => {
        e.preventDefault();
        window.showMap?.();
        mapBtn.classList.remove('outline');
        dirBtn.classList.add('outline');
        history.pushState({}, '', mapBtn.href);
      });
    }
  });
</script>
