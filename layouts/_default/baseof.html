{{/*
  BASE TEMPLATE - Semantic HTML Document Structure
  
  This template demonstrates key accessibility patterns:
  
  1. Skip Link (line 12): Allows keyboard users to bypass navigation
     - Hidden by default, appears on focus (see .skip-link in styles.css)
     - Links to #main-content landmark
  
  2. Semantic Landmarks:
     - <main> wraps primary content (defined in child templates)
     - <nav> in navbar.html partial
     - <article>, <aside>, <section> used within pages
  
  3. Theme Support: data-theme="light" enables PicoCSS theming
     - Can be toggled via JavaScript for dark mode
     - System preference respected via CSS media queries
  
  See also: ACCESSIBILITY.md for full accessibility documentation
*/}}
<!doctype html>
<html lang="en" data-theme="light">
  <head>
    {{- partial "head.html" . -}}
  </head>
  <body>
    {{/* Skip link - appears on Tab press, allows bypassing navigation */}}
    <a href="#main-content" class="skip-link">Skip to main content</a>

    {{- partial "navbar.html" . -}}

    {{/* Main landmark - target of skip link, contains primary page content */}}
    <main id="main-content" class="container-fluid">
      {{- block "main" . }}{{- end }}
    </main>
    <script>document.addEventListener("DOMContentLoaded",()=>lucide.createIcons())</script>
    <script>
    // Dropdown keyboard navigation (a11y enhancement)
    // Enables arrow key navigation in <details class="dropdown"> elements
    (function() {
      document.querySelectorAll("details.dropdown").forEach(details => {
        const summary = details.querySelector("summary");
        const items = details.querySelectorAll("ul a");
        if (!items.length) return;

        let currentIndex = -1;

        function focusItem(index) {
          if (index >= 0 && index < items.length) {
            currentIndex = index;
            items[index].focus();
          }
        }

        // Arrow keys on summary: open and focus first item
        summary?.addEventListener("keydown", e => {
          if (e.key === "ArrowDown") {
            e.preventDefault();
            details.open = true;
            setTimeout(() => focusItem(0), 0);
          }
        });

        // Arrow keys within dropdown
        details.addEventListener("keydown", e => {
          if (!details.open) return;

          switch (e.key) {
            case "ArrowDown":
              e.preventDefault();
              focusItem(currentIndex < items.length - 1 ? currentIndex + 1 : 0);
              break;
            case "ArrowUp":
              e.preventDefault();
              focusItem(currentIndex > 0 ? currentIndex - 1 : items.length - 1);
              break;
            case "Escape":
              e.preventDefault();
              details.open = false;
              summary?.focus();
              currentIndex = -1;
              break;
            case "Home":
              e.preventDefault();
              focusItem(0);
              break;
            case "End":
              e.preventDefault();
              focusItem(items.length - 1);
              break;
          }
        });

        // Reset index when closed
        details.addEventListener("toggle", () => {
          if (!details.open) currentIndex = -1;
        });
      });
    })();
    </script>
  </body>
</html>
