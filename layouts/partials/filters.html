{{/* Filters partial - shared between directory and map pages
  Expects: $companies, $taxonomies, $site (for .Site.Taxonomies)
  
  All filters use single param "f" with taxonomy:key format (e.g., regions:perth)
  
  Taxonomy structure: { key: "Full Name" }
  Company frontmatter stores keys, not display names.
  Icons are at /icons/streams/{key}.png and /icons/ownerships/{key}.png
  
  Uses Hugo's native .Site.Taxonomies for counts.
*/}}
{{- $taxonomies := .taxonomies -}}
{{- $site := .site -}}

{{/* Use Hugo's native taxonomy counts */}}
{{- $stakeholderCounts := $site.Taxonomies.stakeholders -}}
{{- $streamCounts := $site.Taxonomies.capability_streams -}}
{{- $domainCounts := $site.Taxonomies.capability_domains -}}
{{- $industrialCounts := $site.Taxonomies.industrial_capabilities -}}
{{- $regionCounts := $site.Taxonomies.regions -}}
{{- $ownershipCounts := $site.Taxonomies.ownerships -}}

<form class="filters" id="filters" method="get">
  <div class="filters-scroll">
    <!-- Search within filters -->
    <input type="text" id="filter-options" class="filter-search" placeholder="Search filters..." autocomplete="off" aria-label="Search filters">

    <!-- Capability Streams -->
    <section class="filter-section">
      <h4>Capability Streams</h4>
      <div class="stream-icons">
        {{- range $key, $name := $taxonomies.capability_streams -}}
          {{- $term := index $streamCounts $key -}}
          {{- $count := 0 }}{{ with $term }}{{ $count = .Count }}{{ end -}}
          {{- if gt $count 0 }}
        <label class="stream-icon" title="{{ $name }} ({{ $count }})">
          <input type="checkbox" name="f" value="capability_streams:{{ $key }}">
          <img src="{{ printf "icons/streams/%s.png" $key | relURL }}" alt="{{ $name }}">
        </label>
          {{- end -}}
        {{- end }}
      </div>
    </section>

    <!-- Ownership -->
    {{- with $taxonomies.ownerships }}
    <section class="filter-section">
      <h4>Ownership</h4>
      <div class="stream-icons">
        {{- range $key, $name := . -}}
          {{- $term := index $ownershipCounts $key -}}
          {{- $count := 0 }}{{ with $term }}{{ $count = .Count }}{{ end -}}
          {{- if gt $count 0 }}
        <label class="stream-icon" title="{{ $name }} ({{ $count }})">
          <input type="checkbox" name="f" value="ownerships:{{ $key }}">
          <img src="{{ printf "icons/ownerships/%s.png" $key | relURL }}" alt="{{ $name }}">
        </label>
          {{- end -}}
        {{- end }}
      </div>
    </section>
    {{- end }}

    <!-- Stakeholders -->
    <section class="filter-section">
      <h4>Stakeholders</h4>
      <div class="filter-list">
        {{- range $key, $name := $taxonomies.stakeholders -}}
          {{- $term := index $stakeholderCounts $key -}}
          {{- $count := 0 }}{{ with $term }}{{ $count = .Count }}{{ end -}}
          {{- if gt $count 0 }}
        <label class="filter-item">
          <input type="checkbox" name="f" value="stakeholders:{{ $key }}">
          <span class="filter-label">{{ $name }}</span>
          <span class="filter-count">{{ $count }}</span>
        </label>
          {{- end -}}
        {{- end }}
      </div>
    </section>

    <!-- Regions -->
    <section class="filter-section">
      <h4>Regions</h4>
      <div class="filter-list">
        {{- range $key, $name := $taxonomies.regions -}}
          {{- $term := index $regionCounts $key -}}
          {{- $count := 0 }}{{ with $term }}{{ $count = .Count }}{{ end -}}
          {{- if gt $count 0 }}
        <label class="filter-item">
          <input type="checkbox" name="f" value="regions:{{ $key }}">
          <span class="filter-label">{{ $name }}</span>
          <span class="filter-count">{{ $count }}</span>
        </label>
          {{- end -}}
        {{- end }}
      </div>
    </section>

    <!-- Capability Domains -->
    <section class="filter-section">
      <h4>Domains</h4>
      <div class="filter-list">
        {{- range $key, $name := $taxonomies.capability_domains -}}
          {{- $term := index $domainCounts $key -}}
          {{- $count := 0 }}{{ with $term }}{{ $count = .Count }}{{ end -}}
          {{- if gt $count 0 }}
        <label class="filter-item">
          <input type="checkbox" name="f" value="capability_domains:{{ $key }}">
          <span class="filter-label">{{ $name }}</span>
          <span class="filter-count">{{ $count }}</span>
        </label>
          {{- end -}}
        {{- end }}
      </div>
    </section>

    <!-- Industrial Capabilities -->
    <section class="filter-section">
      <h4>Industrial</h4>
      <div class="filter-list">
        {{- range $key, $name := $taxonomies.industrial_capabilities -}}
          {{- $term := index $industrialCounts $key -}}
          {{- $count := 0 }}{{ with $term }}{{ $count = .Count }}{{ end -}}
          {{- if gt $count 0 }}
        <label class="filter-item">
          <input type="checkbox" name="f" value="industrial_capabilities:{{ $key }}">
          <span class="filter-label">{{ $name }}</span>
          <span class="filter-count">{{ $count }}</span>
        </label>
          {{- end -}}
        {{- end }}
      </div>
    </section>
  </div>

  <!-- Sticky footer -->
  <footer class="filters-footer">
    <button type="reset" class="clear-all secondary outline">Clear all filters</button>
  </footer>
</form>
