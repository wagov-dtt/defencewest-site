/**
 * Shared filter utilities for directory and map pages.
 * Expects window.TAXONOMIES to be set before use (generated by Hugo from taxonomyOrder).
 */

/** Parse filter state from URL query parameters. */
function getFiltersFromURL() {
  var params = new URLSearchParams(location.search);
  var filters = { search: (params.get("q") || "").trim().toLowerCase() };
  TAXONOMIES.forEach(function(tax) {
    var vals = params.getAll(tax);
    if (vals.length) filters[tax] = vals;
  });
  return filters;
}

/** Check if a data object (card dataset or company record) matches active filters. */
function matchesFilters(data, filters) {
  if (filters.search && !(data.search || "").includes(filters.search)) return false;
  for (var i = 0; i < TAXONOMIES.length; i++) {
    var tax = TAXONOMIES[i];
    var required = filters[tax];
    if (!required || !required.length) continue;
    var has = (data[tax] || "").split("|");
    if (!required.every(function(v) { return has.includes(v); })) return false;
  }
  return true;
}
