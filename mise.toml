[tools]
python = "3.12"
uv = "latest"
hugo = "latest"
lychee = "latest"

[env]
PYTHONDONTWRITEBYTECODE = "1"
# Fix SSL cert path for pymgl/libcurl
CURL_CA_BUNDLE = "/etc/ssl/certs/ca-certificates.crt"
SSL_CERT_FILE = "/etc/ssl/certs/ca-certificates.crt"

[tasks.setup]
run = ["uv sync", "mise run preprocess"]

[tasks.dev]
depends = ["preprocess"]
run = "hugo server -D --navigateToChanged --disableFastRender"

[tasks.build]
run = ["mise run preprocess", "uv run python scripts/export.py", "hugo --minify --cleanDestinationDir", "mise run linkcheck"]

[tasks.preprocess]
run = "uv run python scripts/preprocess.py"
sources = ["content/company/*.md", "data/taxonomies.yaml"]
outputs = ["data/computed.yaml", "data/counts.yaml"]

[tasks.maps]
description = "Generate static minimap images"
run = "uv run python scripts/preprocess.py --maps"

[tasks.maps-force]
description = "Regenerate all static minimap images"
run = "uv run python scripts/preprocess.py --force-maps"

[tasks.linkcheck]
sources = ["content/**/*.md", "layouts/**/*.html"]
outputs = [".lycheecache"]
run = "lychee public/ --no-progress --cache --max-cache-age 7d || true"

[tasks.scrape]
run = "uv run python scripts/scrape.py"

[tasks.scrape-fresh]
run = "uv run python scripts/scrape.py --fresh"

[tasks.export]
run = "uv run python scripts/export.py"

[tasks.export-csv]
run = "uv run python scripts/export.py csv"

[tasks.export-xlsx]
run = "uv run python scripts/export.py xlsx"
